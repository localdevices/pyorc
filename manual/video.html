
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Videos &#8212; pyorc 0.2.4 documentation</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'manual/video';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Camera configurations" href="camera_config.html" />
    <link rel="prev" title="Manual" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
  
    <p class="title logo__title">pyorc 0.2.4 documentation</p>
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../intro.html">
                        Introduction
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../installation.html">
                        Installation
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../quickstart.html">
                        Quick start
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Manual
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api.html">
                        API reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fas fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../intro.html">
                        Introduction
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../installation.html">
                        Installation
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../quickstart.html">
                        Quick start
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="index.html">
                        Manual
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../api.html">
                        API reference
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Table of Content
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Videos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="camera_config.html">
   Camera configurations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="frames.html">
   Frames
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="velocimetry.html">
   Velocimetry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transect.html">
   Transects
  </a>
 </li>
</ul>

  </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="videos">
<span id="id1"></span><h1>Videos<a class="headerlink" href="#videos" title="Permalink to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This manual is a work in progress.</p>
</div>
<p>Videos and video files are at the core of <em>pyorc</em>. Any analysis starts with a video file. Notably, these can be acquired
from different platforms, with suggestions given in the table below.</p>
<table class="table">
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Platform</p></th>
<th class="head"><p>Use cases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Smartphone</p></td>
<td><p>Ad-hoc collection of data, e.g. during a flood.
Permanent or temporary (e.g. for rating curve updates) and affordable observation
at one location that are orthorectified per video.
Permanent or temporary observations at one location with a fixed mould to
keep a permanent stable objective.</p></td>
</tr>
<tr class="row-odd"><td><p>Drone</p></td>
<td><p>Incidental observations e.g. to monitor velocity distribution around river
restoration sites, new riverine infrastructure, sediment or waste trapping
constructions or other environmental related uses.</p></td>
</tr>
<tr class="row-even"><td><p>IP-camera</p></td>
<td><p>Permanent or temporary observations at measurement site without need for physical
presence. This requires a modem and power source. A power cycling setup is
recommended to take videos in regular intervals.</p></td>
</tr>
<tr class="row-odd"><td><p>Trap camera</p></td>
<td><p>Temporary observations at measurement site without need for physical presence,
Ideal for wet season flow event capturing over a limited time until batteries
run out or SD card is full. Typically uses AA batteries</p></td>
</tr>
</tbody>
</table>
<p><em>pyorc</em> therefore uses a so-called <code class="docutils literal notranslate"><span class="pre">Video</span></code> object to interrogate a video file, add understanding of video’s
perspective (using a <code class="docutils literal notranslate"><span class="pre">CameraConfig</span></code> object and the water level during which the video was taken)
and define which frame range you wish to use to perform analysis on.</p>
<p>Therefore you can pass a number of properties to a <code class="docutils literal notranslate"><span class="pre">Video</span></code> object so as to be able to work with it in <em>pyorc</em>.
Please read the API section on the <code class="docutils literal notranslate"><span class="pre">Video</span></code> object to get details on how to create such a <code class="docutils literal notranslate"><span class="pre">Video</span></code> object. Some
important properties are described below:</p>
<section id="camera-configuration">
<h2>Camera configuration<a class="headerlink" href="#camera-configuration" title="Permalink to this heading">#</a></h2>
<p>Essential for almost all steps after opening a video is to supply a <code class="docutils literal notranslate"><span class="pre">CameraConfig</span></code> with a video. This object contains
all information from the camera’s lens characteristics, perspective, geographical awareness as derived from a sample
image or frame, with control point information in view. As soon as you wish to work with the frames in the video
(e.g. by calling the method <code class="docutils literal notranslate"><span class="pre">get_frames</span></code>) you MUST specify a camera configuration. You can find more information in
<a class="reference internal" href="camera_config.html#camera-config"><span class="std std-ref">Camera configurations</span></a> section.</p>
</section>
<section id="the-current-water-level">
<h2>The current water level<a class="headerlink" href="#the-current-water-level" title="Permalink to this heading">#</a></h2>
<p>If you decide to take multiple videos of the same objective, for instance with a fixed camera rig, or with a smartphone
in a mould, then you can reuse the camera configuration for each video. This is because as long as the perspective does
not change (i.e. you are looking at exactly the same scene from the same location) then also the camera configuration
can remain exactly the same. This is ideal for gathering time series, for instance to interpret river flow during an
event or for permanent video observations of river flow. Per video, there is only one thing that must be provided. This
is the present water level. This can be provided in a locally selected datum (e.g. the level as read from a staff gauge)
and will be related to the water level, as read during the survey, used to construct the camera configuration. The
“current” water level (i.e. commensurate with the situation in the video you are currently processing) can be set with
the option <code class="docutils literal notranslate"><span class="pre">h_0</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To guarantee that the perspective does not change, the following conditions MUST be met:</p>
<ul class="simple">
<li><p>The same lens must be used as used for the control image of the camera configuration. Note that smnartphone often
have multiple lenses e.g. for wide angle versus close-ups. Ensure you have zoom level at the same level as used
for the control image and do not use digital zoom! It generally only reduces image quality.</p></li>
<li><p>The camera must be placed at exactly the same location and oriented to exactly the same objective</p></li>
<li><p>The camera’s resolution and other settings must be exactly the same as during the control image.</p></li>
</ul>
</div>
</section>
<section id="frame-range">
<h2>Frame range<a class="headerlink" href="#frame-range" title="Permalink to this heading">#</a></h2>
<p>You may have recorded a relatively long video and only wish to process a subset of frames. This can be controlled with
the <code class="docutils literal notranslate"><span class="pre">start_frame</span></code> and <code class="docutils literal notranslate"><span class="pre">end_frame</span></code> options. If you set this to an integer larger than 0 and smaller than the maximum
frames available, then only the frames in between will be processed.</p>
</section>
<section id="stabilization">
<h2>Stabilization<a class="headerlink" href="#stabilization" title="Permalink to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Video stabilization is still experimental. Please raise an issue on Github with a link to a video if you experience
issues.</p>
</div>
<p>Videos may be taken in unsteady conditions. This may happen e.g. with slight movements of a smartphone, a
drone that has varying air pressure conditions or wind gusts to deal with, or even fixed cameras in strong winds. But
also, someone may have taken an incidental video, that was not originally intended to be used for river flow and velocity
observations, but may render important information about a flood. For this the <code class="docutils literal notranslate"><span class="pre">stabilize</span></code> option can be passed
with either the value “fixed” for a video without intentional movements, or “moving” for a video with intentional
movements. With this option, each frame will be stabilized with respect to the first frame chosen by the user
(through the option <code class="docutils literal notranslate"><span class="pre">first_frame</span></code>). The method works by first finding well traceable points in the first frame,
then tracing where these points move to in the next frames. Of course some of these points may actually be moving water.
That is why you have to define whether the video is taken with or without intentional movements, so that moving water
can be distinguished from much smaller (larger) movements in the fixed (moving) video.</p>
<table class="table" id="id2">
<caption><span class="caption-text">Small part of 4K drone footage in Rio Grande - Brazil, showing left: no stabilization applied; right:
       stabilization applied with <code class="docutils literal notranslate"><span class="pre">stabilize=&quot;fixed&quot;</span></code>. The algorithm automatically detects rigid points on river
       banks but also on the debris showed in this subscene.</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>Unstable</p></th>
<th class="head" rowspan="2"><p>Stable</p></th>
</tr>
<tr class="row-even"></tr>
</thead>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../_images/video_unstable.gif"><img alt="videounstab" class="align-middle" src="../_images/video_unstable.gif" style="width: 400.0px; height: 292.8px;" /></a></p></td>
<td><p><a class="reference internal" href="../_images/video_stable.gif"><img alt="videostab" class="align-middle" src="../_images/video_stable.gif" style="width: 400.0px; height: 292.8px;" /></a></p></td>
</tr>
</tbody>
</table>
<p>A working example to obtain a stabilized video from our example section is provided below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyorc</span>

<span class="c1"># set a video filename below, change to your own local file location</span>
<span class="n">video_file</span> <span class="o">=</span> <span class="s2">&quot;examples/ngwerere/ngwerere_20191103.mp4&quot;</span>
<span class="c1"># point to a file containing the camera configuration</span>
<span class="n">cam_config</span> <span class="o">=</span> <span class="n">pyorc</span><span class="o">.</span><span class="n">load_camera_config</span><span class="p">(</span><span class="s2">&quot;examples/ngwerere/ngwerere.json&quot;</span><span class="p">)</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">pyorc</span><span class="o">.</span><span class="n">Video</span><span class="p">(</span>
    <span class="n">video_file</span><span class="p">,</span>
    <span class="n">camera_config</span><span class="o">=</span><span class="n">cam_config</span><span class="p">,</span>
    <span class="n">start_frame</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">end_frame</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span>
    <span class="n">stabilize</span><span class="o">=</span><span class="s2">&quot;fixed&quot;</span>
<span class="p">)</span>
<span class="n">video</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you choose to only treat a very short part of a video such as only one second, then it may be difficult for the
stabilizing functions to distinguish rigid points from non-rigid. In this case we recommend to set <code class="docutils literal notranslate"><span class="pre">start_frame</span></code>
and <code class="docutils literal notranslate"><span class="pre">end_frame</span></code> to cover a larger time span, and then make a sub-selection after having retrieved the frames
from the video. This will not be significantly slower, because <em>pyorc</em> utilizes a lazy programming approach and
will then only load and process the frames you select afterwards.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># start with a large frame set for detecting rigid points</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">pyorc</span><span class="o">.</span><span class="n">Video</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">start_frame</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">end_frame</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="c1"># get your frames, and only the first 30</span>
<span class="n">da_frames</span> <span class="o">=</span> <span class="n">video</span><span class="o">.</span><span class="n">get_frames</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>
<span class="c1"># do the rest of your work</span>
</pre></div>
</div>
</div>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="index.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Manual</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="camera_config.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Camera configurations</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fas fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#camera-configuration">
   Camera configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-current-water-level">
   The current water level
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#frame-range">
   Frame range
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stabilization">
   Stabilization
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../_sources/manual/video.rst.txt">
        <i class="fas fa-file-alt"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022, Rainbow Sensing.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>